'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.validateSchemaDefinition = validateSchemaDefinition;

var _graphql = require('graphql');

var _validation = require('graphql/validation');

var _buildASTSchema = require('graphql/utilities/buildASTSchema');

var _error = require('graphql/error');

function validateSchemaDefinition(schemaDefinition, rules, configuration) {
  var ast = void 0;
  try {
    ast = (0, _graphql.parse)(schemaDefinition);
  } catch (e) {
    if (e instanceof _error.GraphQLError) {
      return [e];
    } else {
      throw e;
    }
  }
  var schema = (0, _buildASTSchema.buildASTSchema)(ast, {
    commentDescriptions: configuration.getCommentDescriptions()
  });

  var rulesWithConfiguration = rules.map(function (rule) {
    return ruleWithConfiguration(rule, configuration);
  });

  var errors = (0, _validation.validate)(schema, ast, rulesWithConfiguration);
  var sortedErrors = sortErrors(errors);

  return sortedErrors;
}

function sortErrors(errors) {
  return errors.sort(function (a, b) {
    return a.locations[0].line - b.locations[0].line;
  });
}

function ruleWithConfiguration(rule, configuration) {
  if (rule.length == 2) {
    return function (context) {
      return rule(configuration, context);
    };
  } else {
    return rule;
  }
}